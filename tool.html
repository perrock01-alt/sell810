<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดการสินค้า (JSON Generator)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background-color: #e9ecef; font-family: 'Sarabun', sans-serif; padding: 20px; }
        .card { box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: none; }
        .preview-img { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }
        .code-area { background: #212529; color: #00ff9d; font-family: monospace; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4"><i class="bi bi-tools"></i> เครื่องมือสร้างไฟล์ products.json</h2>

    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <i class="bi bi-box-arrow-in-down"></i> ขั้นตอนที่ 1: นำเข้าข้อมูลเดิม (ถ้ามี)
        </div>
        <div class="card-body">
            <p class="small text-muted">ถ้ามีไฟล์ products.json อยู่แล้ว ให้เปิดไฟล์นั้น ก๊อปปี้ข้อความทั้งหมดมาวางช่องนี้ แล้วกด "โหลดข้อมูล"</p>
            <textarea id="importArea" class="form-control mb-2" rows="3" placeholder="วางโค้ด JSON เดิมที่นี่..."></textarea>
            <button onclick="loadJson()" class="btn btn-warning btn-sm">โหลดข้อมูลมาแก้ไข</button>
            <button onclick="clearAll()" class="btn btn-outline-danger btn-sm float-end">ล้างข้อมูลทั้งหมด</button>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-pencil-square"></i> เพิ่ม / แก้ไขสินค้า
                </div>
                <div class="card-body">
                    <form id="productForm">
                        <div class="mb-2">
                            <label>ID (ห้ามซ้ำ)</label>
                            <input type="number" id="p_id" class="form-control" required placeholder="เช่น 1">
                        </div>
                        <div class="mb-2">
                            <label>ชื่อสินค้า</label>
                            <input type="text" id="p_name" class="form-control" required placeholder="เช่น มาม่า">
                        </div>
                        <div class="mb-2">
                            <label>ราคา (บาท)</label>
                            <input type="number" id="p_price" class="form-control" required placeholder="เช่น 15">
                        </div>
                        <div class="mb-2">
                            <label>ชื่อไฟล์รูป</label>
                            <input type="text" id="p_image" class="form-control" required placeholder="images/mama.jpg">
                            <small class="text-muted" style="font-size: 0.7em;">*ต้องเอารูปไปใส่โฟลเดอร์ images ก่อนนะ</small>
                        </div>
                        <div class="mb-2">
                            <label>รายละเอียด</label>
                            <textarea id="p_desc" class="form-control" rows="2" placeholder="รสชาติ..."></textarea>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="p_stock" checked>
                            <label class="form-check-label" for="p_stock">มีของพร้อมขาย (In Stock)</label>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="button" onclick="saveProduct()" class="btn btn-primary">บันทึกรายการนี้</button>
                            <button type="button" onclick="resetForm()" class="btn btn-secondary btn-sm">ล้างฟอร์ม</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <i class="bi bi-list-check"></i> รายการสินค้าทั้งหมด
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                        <table class="table table-striped table-hover mb-0 text-center align-middle">
                            <thead class="table-dark sticky-top">
                                <tr>
                                    <th>รูป</th>
                                    <th>ID</th>
                                    <th>ชื่อ</th>
                                    <th>ราคา</th>
                                    <th>สถานะ</th>
                                    <th>จัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <span><i class="bi bi-code-slash"></i> ขั้นตอนที่ 2: ผลลัพธ์ (ก๊อปปี้ไปทับไฟล์ products.json)</span>
            <button onclick="copyToClipboard()" class="btn btn-success btn-sm"><i class="bi bi-clipboard"></i> คัดลอกโค้ด</button>
        </div>
        <div class="card-body p-0">
            <textarea id="jsonOutput" class="form-control code-area" rows="10" readonly></textarea>
        </div>
    </div>
</div>

<script>
    let products = [];

    // ฟังก์ชันโหลด JSON จาก Textarea เข้าสู่ระบบ
    function loadJson() {
        const input = document.getElementById('importArea').value;
        try {
            if(!input.trim()) return alert("กรุณาวางโค้ด JSON ก่อนครับ");
            products = JSON.parse(input);
            renderTable();
            updateOutput();
            alert("โหลดข้อมูลเรียบร้อย! แก้ไขต่อได้เลย");
        } catch (e) {
            alert("รูปแบบ JSON ไม่ถูกต้อง! ลองเช็คดูว่าก๊อปมาครบไหม");
        }
    }

    // ฟังก์ชันบันทึกสินค้า (เพิ่มใหม่ หรือ แก้ไขตัวเดิม)
    function saveProduct() {
        const id = parseInt(document.getElementById('p_id').value);
        const name = document.getElementById('p_name').value;
        const price = parseInt(document.getElementById('p_price').value);
        const image = document.getElementById('p_image').value;
        const description = document.getElementById('p_desc').value;
        const in_stock = document.getElementById('p_stock').checked;

        if (!id || !name || !price) {
            alert("กรุณากรอก ID, ชื่อ และราคา ให้ครบ");
            return;
        }

        // เช็คว่ามี ID นี้อยู่แล้วไหม
        const existingIndex = products.findIndex(p => p.id === id);

        const newProduct = { id, name, price, image, description, in_stock };

        if (existingIndex >= 0) {
            // ถ้ามีอยู่แล้ว -> อัปเดตข้อมูลทับ
            products[existingIndex] = newProduct;
        } else {
            // ถ้าไม่มี -> เพิ่มใหม่
            products.push(newProduct);
        }

        // เรียงลำดับตาม ID
        products.sort((a, b) => a.id - b.id);

        renderTable();
        updateOutput();
        resetForm();
    }

    // ฟังก์ชันแสดงตาราง
    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';

        products.forEach(p => {
            const row = `
                <tr>
                    <td><img src="${p.image}" class="preview-img" onerror="this.src='https://via.placeholder.com/50'"></td>
                    <td>${p.id}</td>
                    <td class="text-start">${p.name}</td>
                    <td>${p.price}</td>
                    <td>${p.in_stock ? '<span class="badge bg-success">มีของ</span>' : '<span class="badge bg-danger">หมด</span>'}</td>
                    <td>
                        <button onclick="editProduct(${p.id})" class="btn btn-warning btn-sm"><i class="bi bi-pencil"></i></button>
                        <button onclick="deleteProduct(${p.id})" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // ฟังก์ชันดึงข้อมูลมาใส่ฟอร์มเพื่อแก้ไข
    function editProduct(id) {
        const product = products.find(p => p.id === id);
        if (product) {
            document.getElementById('p_id').value = product.id;
            document.getElementById('p_name').value = product.name;
            document.getElementById('p_price').value = product.price;
            document.getElementById('p_image').value = product.image;
            document.getElementById('p_desc').value = product.description;
            document.getElementById('p_stock').checked = product.in_stock;
        }
    }

    // ฟังก์ชันลบสินค้า
    function deleteProduct(id) {
        if(confirm("ยืนยันลบสินค้านี้?")) {
            products = products.filter(p => p.id !== id);
            renderTable();
            updateOutput();
        }
    }

    // อัปเดตช่องแสดงผล JSON
    function updateOutput() {
        document.getElementById('jsonOutput').value = JSON.stringify(products, null, 2);
    }

    // ล้างฟอร์ม
    function resetForm() {
        document.getElementById('productForm').reset();
        document.getElementById('p_stock').checked = true;
        // Auto increment ID แนะนำ ID ถัดไป
        if(products.length > 0) {
            const maxId = Math.max(...products.map(p => p.id));
            document.getElementById('p_id').value = maxId + 1;
        } else {
            document.getElementById('p_id').value = 1;
        }
    }

    // คัดลอกโค้ด
    function copyToClipboard() {
        const copyText = document.getElementById("jsonOutput");
        copyText.select();
        document.execCommand("copy");
        alert("คัดลอกโค้ดแล้ว! \nไปที่ไฟล์ products.json ลบอันเก่าออก แล้วกด Ctrl+V วางได้เลย");
    }

    function clearAll() {
        if(confirm("ล้างข้อมูลทั้งหมดจริงหรือไม่?")) {
            products = [];
            renderTable();
            updateOutput();
        }
    }

    // เริ่มต้น
    updateOutput();
</script>

</body>
</html>